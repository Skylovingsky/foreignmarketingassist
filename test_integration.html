<!DOCTYPE html>
<html>
<head>
    <title>å‰ç«¯åç«¯é›†æˆæµ‹è¯•</title>
    <meta charset="UTF-8">
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .customer { border: 1px solid #ccc; padding: 10px; margin: 10px 0; }
        .btn { background: #007bff; color: white; padding: 8px 16px; border: none; cursor: pointer; }
        .btn:disabled { background: #ccc; }
        .analysis { background: #f8f9fa; padding: 10px; margin-top: 10px; }
    </style>
</head>
<body>
    <h1>ğŸ§ª å‰ç«¯åç«¯é›†æˆæµ‹è¯•</h1>
    
    <div id="status">æ­£åœ¨åŠ è½½å®¢æˆ·æ•°æ®...</div>
    
    <div id="customers"></div>
    
    <script>
        const API_BASE = 'https://3001-ibr8pve55krqf22np4xrh-6532622b.e2b.dev';
        
        // è·å–å®¢æˆ·æ•°æ®
        async function loadCustomers() {
            try {
                console.log('ğŸ”„ å¼€å§‹è·å–å®¢æˆ·æ•°æ®...');
                const response = await fetch(`${API_BASE}/api/customers`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log('âœ… å®¢æˆ·æ•°æ®è·å–æˆåŠŸ:', data);
                
                displayCustomers(data.data);
                document.getElementById('status').innerHTML = `âœ… æˆåŠŸåŠ è½½ ${data.data.length} ä¸ªå®¢æˆ·`;
            } catch (error) {
                console.error('âŒ è·å–å®¢æˆ·æ•°æ®å¤±è´¥:', error);
                document.getElementById('status').innerHTML = `âŒ é”™è¯¯: ${error.message}`;
            }
        }
        
        // æ˜¾ç¤ºå®¢æˆ·åˆ—è¡¨
        function displayCustomers(customers) {
            const container = document.getElementById('customers');
            container.innerHTML = '';
            
            customers.forEach(customer => {
                const div = document.createElement('div');
                div.className = 'customer';
                
                div.innerHTML = `
                    <h3>${customer.companyName}</h3>
                    <p>ğŸ‘¤ è”ç³»äºº: ${customer.contactName}</p>
                    <p>ğŸ“§ é‚®ç®±: ${customer.email}</p>
                    <p>ğŸŒ ç½‘ç«™: <a href="${customer.website}" target="_blank">${customer.website}</a></p>
                    <p>ğŸ­ è¡Œä¸š: ${customer.industry} | ğŸŒ å›½å®¶: ${customer.country}</p>
                    
                    <button class="btn" onclick="analyzeCustomer('${customer.id}', '${customer.website}', this)">
                        ğŸ¤– AIåˆ†æ
                    </button>
                    
                    <div id="analysis-${customer.id}" class="analysis" style="display: none;"></div>
                `;
                
                container.appendChild(div);
            });
        }
        
        // AIåˆ†æåŠŸèƒ½
        async function analyzeCustomer(customerId, website, button) {
            try {
                button.disabled = true;
                button.innerHTML = 'â³ åˆ†æä¸­...';
                
                console.log(`ğŸ¤– å¼€å§‹AIåˆ†æ: ${website}`);
                
                const response = await fetch(`${API_BASE}/api/ai-analysis/analyze-url`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        url: website,
                        businessContext: {
                            companyName: 'Global Trade Solutions',
                            industry: 'International Trade Services',
                            services: ['Export Services', 'Supply Chain Management'],
                            targetMarkets: ['Europe', 'Asia', 'North America'],
                            uniqueValueProposition: 'End-to-end international trade solutions'
                        },
                        analysisDepth: 'detailed',
                        language: 'zh'
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`AIåˆ†æå¤±è´¥: ${response.status}`);
                }
                
                const result = await response.json();
                console.log('âœ… AIåˆ†æå®Œæˆ:', result);
                
                if (result.success && result.data.analysis) {
                    displayAnalysis(customerId, result.data.analysis);
                    button.innerHTML = 'âœ… åˆ†æå®Œæˆ';
                } else {
                    throw new Error('AIåˆ†æè¿”å›æ ¼å¼é”™è¯¯');
                }
                
            } catch (error) {
                console.error('âŒ AIåˆ†æå¤±è´¥:', error);
                button.innerHTML = 'âŒ åˆ†æå¤±è´¥';
                alert(`AIåˆ†æå¤±è´¥: ${error.message}`);
            } finally {
                button.disabled = false;
            }
        }
        
        // æ˜¾ç¤ºAIåˆ†æç»“æœ
        function displayAnalysis(customerId, analysis) {
            const container = document.getElementById(`analysis-${customerId}`);
            container.style.display = 'block';
            
            container.innerHTML = `
                <h4>ğŸ¯ AIåˆ†æç»“æœ</h4>
                <p><strong>ç»¼åˆè¯„åˆ†:</strong> ${analysis.overallScore}/100</p>
                <p><strong>ä¼˜å…ˆçº§:</strong> ${analysis.priority}</p>
                
                <h5>ğŸ“Š äº”ç»´åº¦è¯„åˆ†:</h5>
                <ul>
                    <li>ğŸ¯ å¸‚åœºæ½œåŠ›: ${analysis.dimensions.marketPotential.score}/100</li>
                    <li>ğŸ¤ ä¸šåŠ¡åŒ¹é…: ${analysis.dimensions.businessMatching.score}/100</li>
                    <li>ğŸ“ å¯è”ç³»æ€§: ${analysis.dimensions.contactability.score}/100</li>
                    <li>âš¡ ç«äº‰ä¼˜åŠ¿: ${analysis.dimensions.competitiveAdvantage.score}/100</li>
                    <li>â° ç´§æ€¥ç¨‹åº¦: ${analysis.dimensions.urgencyLevel.score}/100</li>
                </ul>
                
                <h5>ğŸ’¡ AIå»ºè®®:</h5>
                <p>${analysis.recommendation}</p>
                
                <h5>ğŸ“§ é‚®ä»¶æ¨¡æ¿:</h5>
                <p><strong>ä¸»é¢˜:</strong> ${analysis.outreachMessages.email.subject}</p>
                <details>
                    <summary>æŸ¥çœ‹é‚®ä»¶å†…å®¹</summary>
                    <pre style="white-space: pre-wrap; font-size: 12px;">${analysis.outreachMessages.email.content}</pre>
                </details>
            `;
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è·å–æ•°æ®
        window.onload = loadCustomers;
    </script>
</body>
</html>